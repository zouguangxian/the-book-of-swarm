
\subsection{邮票的上传}
\subsubsection{见证类型}

可以有在\emph{付款证明}的结构和语义上不同的邮票实现。为了允许在开发新的加密机制时使用它们，\lstinline{witnessType}参数指示所使用的证人的类型。 

见证类型$0$代表ECDSA见证，它是一个字节片上的ECDSA签名，该签名由1)序言常量2)块哈希3)批处理引用4)有效到date.% 
%
\footnote{ECDSA签名的二进制编码是65字节，由该签名的$r$(32字节)、$s$(32字节)和$v$(1字节)参数串联而成。该签名按照secp256k1椭圆曲线计算，就像以太坊交易的签名一样。}
%
这是邮票合同和客户必须实现的最低要求。%
%
\footnote{就戳戳验证契约所消耗的气体和链外使用的计算资源而言，ECDSA见证是最简单和最便宜的解决方案。此外，除了以太坊严重依赖的加密假设之外，它并不依赖加密假设，因此只要以太坊被认为是加密安全的，加密技术的任何进步都不能使这种见证类型变得不安全。这是证明该证人类型是唯一要执行的强制性证人类型的理由。}

见证类型$1$是RSA见证，它是与上述相同的128字节上的RSA签名。RSA签名的二进制编码是可变长度的，是RSA签名$s$.%的Solidity ABI编码数组
%
\footnote{如在\emph{PKCS \# 1}、\url{https://tools.ietf.org/html/rfc8017}和RSA公钥参数$n$ (RSA模量)和$e$(公共指数)中定义的。}

指定RSA见证，这样就可以以一种简单的方式实现盲戳服务，以减轻链接使用相同私钥签名的块的能力所带来的隐私问题。即使盲ECDSA签名也存在，但它们的协议需要更多的通信轮数，这使得此类服务的实现更加复杂，更容易出错，性能也更差。 

包含整个每个RSA公钥的见证而不是存储在合同的公钥状态和刚从证人引用它通过减少天然气的成本是合理的交互设计与合同以及能否经得住时间的考验,以防在Ethereum租引入合同状态。这些考虑比邮票的简便性更重要，略微降低了上传和转发盖章内容的成本。

请注意，加密技术的进步可以使RSA证人不安全，而不会使以太坊不安全，因此，如果RSA签名的安全性受到威胁，RSA证人可以在协议的未来版本中逐步淘汰。此外，请注意，这种盲签名服务并不是完全不可信的，因为它们可能造成的损害是有限的。基于ZK证明的无Trustless blind stamping服务在现阶段还不可行，目前的算法性能还不够，但考虑到该领域的快速发展，未来可以期待合适的算法的发展。在这种情况下，必须在单独的SWIP中指定相应的见证类型。

\subsubsection{合同的升级}

为了便于在发现漏洞或某些特性扩展(如添加新的证人类型)的情况下升级合同，建议将拥有付款数据库的资金的那部分和核查证人的那部分分别订立合同，以便能够在最少中断的情况下进行向后兼容的升级。

为了避免集中控制，还建议在客户端配置中引用证人验证合同，以便客户端操作人员可以在新合同可用时独立决定何时以及是否切换到新合同。


参与同一邮资系统的节点被配置为在同一区块链上引用同一合同。本合同必须符合以下接口:

\begin{definition}[Postage contract]\label{def:postage}

\end{definition}


如果\lstinline{witness}包含的证明检查出声明中的所有其他参数，则此访问器方法返回\lstinline{true} 
有效期，即\lstinline{block.timestamp} (\lstinline{TIMESTAMP EVM}操作码的输出)介于\lstinline{beginValidity}(含)和 
\lstinline{endValidity}(独家)。在有效期之外，返回值为\lstinline{undefined}。
 

\begin{definition}[Postage stamp basic types: batchID, address, witness, stamp, validity]\label{def:postage-stamp}
\begin{lstlisting}[language=buzz1]
// /postage

define type batchid as [segment size]byte  
define type address as bzz/address
define type witness as crypo/signature

// postage stamp
define type stamp  
    batchid
    address
    witness

define function valid stamp
as 
    // check validity on blockchain
    ethereum call "valid" using context contracts "postage"
        with @stamp
        
\end{lstlisting}
\end{definition}

\subsection{邮资订阅}\label{spec:format:subscriptions}

\subsection{邮资彩票比赛}\label{spec:format:race}